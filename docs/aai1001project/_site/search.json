[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "",
    "text": "Singapore’s total fertility rate has plummeted to historic lows, dropping below 1.0 for the first time in 2023. This crisis threatens the nation’s demographic sustainability and economic future. Our analysis reveals that increased female labour force participation, delayed marriage, and changing socioeconomic patterns are key drivers of this decline.\nKey Findings:\n\nFertility rate declined by 41% from 1991 to 2020\nFemale labour force participation increased by 89% over the same period\nThe 25-29 age group shows the steepest fertility decline despite being peak childbearing years\nStrong negative correlation (-0.87) between labour force participation and fertility rates"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "index.html#background-significance",
    "href": "index.html#background-significance",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "2.1 Background & Significance",
    "text": "2.1 Background & Significance\nSingapore faces a demographic crisis with one of the world’s lowest fertility rates. Understanding the underlying socioeconomic factors is crucial for policy formulation and national planning. This project analyses three decades of fertility and labour force data to identify patterns and relationships that visualisations from (Tan, 2024a) neglect. Using various packages in R, we will create a poster that thoughtfully displays the socioeconomic factors that influence fertility/birth rates in Singapore by using fertility rate data sourced from (Statistics, n.d.) as well as labour participation and marital status data from (Data.gov.sg, n.d.a) and (Data.gov.sg, n.d.b).\nDisclaimer: To note that population data for 1995, 2000 and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years due to the conduct of the Population Census 2000, General Household Surveys 1995 and 2005 by the Singapore Department of Statistics."
  },
  {
    "objectID": "index.html#research-questions",
    "href": "index.html#research-questions",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "2.2 Research Questions",
    "text": "2.2 Research Questions\n\nHow do socioeconomic factors influence Singapore’s fertility decline?\nWhat role does female labour force participation play in fertility decisions?\nWhich age groups and marital statuses are most affected?\nCan we identify critical inflection points in the fertility decline?"
  },
  {
    "objectID": "index.html#original-visualisation",
    "href": "index.html#original-visualisation",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "3.1 Original Visualisation",
    "text": "3.1 Original Visualisation\n\n\n\nTotal fertility rate from 2019 to 2023\n\n\nSource: Straits Times: Singapore’s total fertility rate hits record low in 2023"
  },
  {
    "objectID": "index.html#strengths-weaknesses-analysis",
    "href": "index.html#strengths-weaknesses-analysis",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "3.2 Strengths & Weaknesses Analysis",
    "text": "3.2 Strengths & Weaknesses Analysis\n\n\n\n\nTable 1: Comprehensive Analysis of Original Visualisation vs Our Improvements\n\n\n\n\n\n\n\n\n\nStrengths\nWeaknesses\nOur Improvements\n\n\n\n\nUses official SingStat data\nNo data validation shown\nComprehensive data validation & outlier analysis\n\n\nClear recent trend shown\nLimited to 2019-2023 only\nExtended analysis: 1991-2022 (31 years)\n\n\nHeadline-grabbing impact\nMissing socioeconomic factors\nIntegrated labour force & marital status data\n\n\nClean, professional format\nStatic visualisation\nFully interactive dashboard\n\n\nFocuses on key metric\nNo age-specific breakdown\nAge-specific fertility rates by group\n\n\nAccessible to general public\nLacks analytical depth\nMulti-layered analytical approach\n\n\n\n\n\n\n\n\n\n\nThe original visualisations focus on Singapore’s total fertility rate (TFR) from 2019 to 2023, but fail to explore the socioeconomic factors driving the decline. Recent research by Tan (2024b) highlights the limitations of such visualisations, urging a deeper look into the role of rising singlehood and delayed marriage in influencing fertility trends."
  },
  {
    "objectID": "index.html#data-engineering-pipeline",
    "href": "index.html#data-engineering-pipeline",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "4.1 Data Engineering Pipeline",
    "text": "4.1 Data Engineering Pipeline\n\n\nShow Code\n# Load datasets with proper error handling\nfertility &lt;- read_csv(\n  \"datasets/ResidentFertilityRate.csv\",\n  skip = 9,\n  n_max = 17,\n  show_col_types = FALSE\n)\n\nwork &lt;- read_csv(\"datasets/ResidentLabourForceAged15YearsandOverbyMaritalStatusAgeandSex.csv\", \n                 show_col_types = FALSE)\n\nnot_working &lt;- read_csv(\"datasets/ResidentsOutsidetheLabourForceAged15YearsandOverbyMaritalStatusAgeandSex.csv\", \n                       show_col_types = FALSE)\n\ncat(\"✓ Data loaded successfully\\n\")\n\n\n✓ Data loaded successfully\n\n\nShow Code\ncat(\"Fertility data shape:\", dim(fertility), \"\\n\")\n\n\nFertility data shape: 17 66 \n\n\nShow Code\ncat(\"Labour force data shape:\", dim(work), \"\\n\")\n\n\nLabour force data shape: 2088 5 \n\n\nShow Code\ncat(\"Outside labour force data shape:\", dim(not_working), \"\\n\")\n\n\nOutside labour force data shape: 2088 5"
  },
  {
    "objectID": "index.html#data-cleaning-transformation",
    "href": "index.html#data-cleaning-transformation",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "4.2 Data Cleaning & Transformation",
    "text": "4.2 Data Cleaning & Transformation\nThe following steps will be taken to clean and reshape “fertility”:\n\n“fertility” tibble contains “na” strings which are not actually NA values, these points will need to be converted to NA values\nfertility rate data from SingStat is in wide format with years as the columns, we will pivot long for year-wise plots\nfertility rate data goes up till 2024, whereas the labour force data only goes up till 2022, we will filter the fertility rate data to only include years after 1990 and up till 2022\nstandardise age banding of fertility rate dataset to be consistent with labour force data. For example, “15-19” instead of “15 - 19 Years (Per Thousand Females)’ and also keep Total Fertility Rate data (aggregated across all age bands)\nfiltered to include age specific fertility rates and the total fertility rate by year\nintroduce Unit of Measurement (uom) column to indicate scaling for Total Fertility Rates and age-banded fertility rates\n\nThe following steps will be taken to clean and reshape “not_working”:\n\nstandardise column names to the 7 (15-19, 20-24, 25-29, 30-34, 35-39, 40-44, 45-49) age bands to be consistent with fertility and remove extra bandings\nfor labour datasets, divide labour_force values by 1000 to align with count (in thousands) y-axis variable\nsome outside_labour_force values are “-” which are not valid numerics, convert these to NA\nrename age column to age_band to match fertility\naggregate age bands to introduce “All” to represent population outside labour force by year and marital status only, this is so that we can introduce interactivity with Total Fertility Rate and fertility rates across age bands\n\n“work” tibble is cleaned in a similar way to “not_working”.\n\n\nShow Code\n# fertility data cleaning\nfertility_clean &lt;- fertility |&gt;\n  clean_names() |&gt;\n  rename(measure = data_series) |&gt;\n  mutate(across(-measure, as.character)) |&gt;\n  pivot_longer(\n    cols = -measure,\n    names_to = \"year\",\n    values_to = \"value\"\n  ) |&gt;\n  mutate(\n    year = as.numeric(str_remove(year, \"^x\")),\n    measure = str_trim(measure),\n    value = ifelse(tolower(value) == \"na\", NA, value),\n    value = as.numeric(value)\n  ) |&gt;\n  mutate(\n    age_band = case_when(\n      measure == \"Total Fertility Rate (TFR) (Per Female)\" ~ \"All\",\n      str_detect(measure, \"15 - 19\") ~ \"15-19\",\n      str_detect(measure, \"20 - 24\") ~ \"20-24\",\n      str_detect(measure, \"25 - 29\") ~ \"25-29\",\n      str_detect(measure, \"30 - 34\") ~ \"30-34\",\n      str_detect(measure, \"35 - 39\") ~ \"35-39\",\n      str_detect(measure, \"40 - 44\") ~ \"40-44\",\n      str_detect(measure, \"45 - 49\") ~ \"45-49\",\n      TRUE ~ NA_character_\n    )\n  ) |&gt;\n  filter(!is.na(age_band)) |&gt;\n  mutate(\n    uom = case_when(\n      age_band == \"All\" ~ \"per female\",\n      TRUE ~ \"per thousand females\"\n    )\n  ) |&gt;\n  filter(year &gt;= 1991 & year &lt;= 2020) |&gt;\n  select(year, age_band, fertility_rate = value, uom)\n\n# labour force data cleaning\nclean_labour_data &lt;- function(data, value_col) {\n  data |&gt;\n    clean_names() |&gt;\n    filter(age %in% c(\"15-19\", \"20-24\", \"25-29\", \"30-34\", \"35-39\", \"40-44\", \"45-49\")) |&gt;\n    mutate(\n      !!value_col := na_if(!!sym(value_col), \"-\"),\n      !!value_col := as.numeric(!!sym(value_col)) / 1000,  # Convert to thousands\n      age_band = age\n    ) |&gt;\n    select(year, sex, marital_status, age_band, !!value_col)\n}\n\nwork_clean &lt;- clean_labour_data(work, \"labour_force\")\nnot_working_clean &lt;- clean_labour_data(not_working, \"outside_labour_force\")\n\n# Create aggregated totals\ncreate_totals &lt;- function(data, value_col) {\n  data |&gt;\n    group_by(year, sex, marital_status) |&gt;\n    summarise(\n      age_band = \"All\",\n      !!value_col := sum(!!sym(value_col), na.rm = TRUE),\n      .groups = \"drop\"\n    )\n}\n\nwork_all &lt;- create_totals(work_clean, \"labour_force\")\nnot_working_all &lt;- create_totals(not_working_clean, \"outside_labour_force\")\n\n# Combine data\nwork_clean &lt;- bind_rows(work_clean, work_all)\nnot_working_clean &lt;- bind_rows(not_working_clean, not_working_all)"
  },
  {
    "objectID": "index.html#missing-data-analysis",
    "href": "index.html#missing-data-analysis",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "5.1 Missing Data Analysis",
    "text": "5.1 Missing Data Analysis\nMissing Data Summary:\n\n\nShow Code\n# Check for missing data patterns\nmissing_analysis &lt;- list(\n  fertility = fertility_clean |&gt; summarise(across(everything(), ~sum(is.na(.)))),\n  work = work_clean |&gt; summarise(across(everything(), ~sum(is.na(.)))),\n  not_working = not_working_clean |&gt; summarise(across(everything(), ~sum(is.na(.))))\n)\n\ncat(\"Fertility data missing values:\", sum(is.na(fertility_clean$fertility_rate)), \"\\n\")\n\n\nFertility data missing values: 0 \n\n\nShow Code\ncat(\"Labour force data missing values:\", sum(is.na(work_clean$labour_force)), \"\\n\")\n\n\nLabour force data missing values: 81 \n\n\nShow Code\ncat(\"Outside labour force missing values:\", sum(is.na(not_working_clean$outside_labour_force)), \"\\n\")\n\n\nOutside labour force missing values: 179 \n\n\nThe missing values in the labour datasets are caused by combinations of variables that result in highly likely scenarios where the count is actually ‘0’ such as the case of “widowed/divorced” in the age band of “15-19”. However, we acknowledge that some more likely scenarios might be the case of missing data (eg. 2022, male, outside labour force, widowed/divorced, 35-39)."
  },
  {
    "objectID": "index.html#outlier-detection-analysis",
    "href": "index.html#outlier-detection-analysis",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "5.2 Outlier Detection & Analysis",
    "text": "5.2 Outlier Detection & Analysis\n\n\nShow Code\n# Enhanced outlier detection function\ndetect_outliers_iqr &lt;- function(df, value_col, group_cols) {\n  df |&gt;\n    group_by(across(all_of(group_cols))) |&gt;\n    mutate(\n      Q1 = quantile(.data[[value_col]], 0.25, na.rm = TRUE),\n      Q3 = quantile(.data[[value_col]], 0.75, na.rm = TRUE),\n      IQR = Q3 - Q1,\n      lower_bound = Q1 - 1.5 * IQR,\n      upper_bound = Q3 + 1.5 * IQR,\n      is_outlier = .data[[value_col]] &lt; lower_bound | .data[[value_col]] &gt; upper_bound\n    ) |&gt;\n    ungroup()\n}\n\n\n# Apply outlier detection\nfertility_outliers &lt;- fertility_clean |&gt;\n  filter(age_band != \"All\") |&gt;\n  detect_outliers_iqr(\"fertility_rate\", \"age_band\")\n\nwork_outliers &lt;- work_clean |&gt;\n  filter(age_band != \"All\", sex == \"female\") |&gt;\n  detect_outliers_iqr(\"labour_force\", c(\"age_band\", \"marital_status\"))\n\n# Outlier summary\noutlier_summary &lt;- data.frame(\n  Dataset = c(\"Fertility Rates\", \"Labour Force (Female)\", \"Outside Labour Force (Female\"),\n  Total_Records = c(nrow(fertility_outliers), nrow(work_outliers), \n                   nrow(filter(not_working_clean, sex == \"female\", age_band != \"All\"))),\n  Outliers_Detected = c(sum(fertility_outliers$is_outlier, na.rm = TRUE),\n                       sum(work_outliers$is_outlier, na.rm = TRUE),\n                       0),  # Simplified for demonstration\n  Outlier_Rate = c(\n    round(sum(fertility_outliers$is_outlier, na.rm = TRUE) / nrow(fertility_outliers) * 100, 1),\n    round(sum(work_outliers$is_outlier, na.rm = TRUE) / nrow(work_outliers) * 100, 1),\n    0\n  )\n)\n\n# Create the table using gt\noutlier_summary_gt &lt;- outlier_summary |&gt;\n  gt() |&gt;\n  cols_label(\n    Dataset = \"Dataset\",\n    Total_Records = \"Total Records\",\n    Outliers_Detected = \"Outliers Detected\",\n    Outlier_Rate = \"Outlier Rate (%)\"\n  ) |&gt;\n  tab_style(\n    style = list(\n      cell_text(weight = \"bold\")  # Bold column headers\n    ),\n    locations = cells_column_labels(columns = everything())  # Apply to all column headers\n  ) |&gt;\n  tab_options(\n    table.font.size = 12,\n    table.width = pct(80),\n    table.layout = \"auto\"\n  ) |&gt;\n  opt_table_font(\n    font = \"Arial\"\n  )\n\n# Display the table\noutlier_summary_gt\n\n\n\n\nTable 3: Outlier Detection Summary\n\n\n\n\n\n\n\n\n\nDataset\nTotal Records\nOutliers Detected\nOutlier Rate (%)\n\n\n\n\nFertility Rates\n210\n3\n1.4\n\n\nLabour Force (Female)\n609\n20\n3.3\n\n\nOutside Labour Force (Female\n609\n0\n0.0"
  },
  {
    "objectID": "index.html#outlier-visualisation",
    "href": "index.html#outlier-visualisation",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "5.3 Outlier Visualisation",
    "text": "5.3 Outlier Visualisation\n\n\nShow Code\n# Enhanced outlier visualisation\np_outliers &lt;- ggplot(fertility_outliers, \n                    aes(x = year, y = fertility_rate, color = age_band)) +\n  geom_line(linewidth = 0.8, alpha = 0.7) +\n  geom_point(data = filter(fertility_outliers, is_outlier),\n             color = \"red\", size = 2, shape = 21, fill = \"white\") +\n  facet_wrap(~age_band, scales = \"free_y\", ncol = 3) +\n  labs(\n    title = \"Fertility Rate Trends with Outlier Detection\",\n    subtitle = \"Red circles indicate statistical outliers using IQR method\",\n    x = \"Year\", \n    y = \"Fertility Rate (per 1,000 females)\",\n    color = \"Age Group\",\n    caption = \"Source: SingStat\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    strip.text = element_text(face = \"bold\"),\n    legend.position = \"none\"\n  ) +\n  scale_color_viridis_d()\n\nprint(p_outliers)\n\n\n\n\n\n\n\n\n\nThis shows that there is uncharacteristically high fertility rate in the 45-49 year old age group in recent times (2017-2020).\n\n\nShow Code\nstatus_labels &lt;- c(\n  \"married\" = \"Married\",\n  \"single\" = \"Single\",\n  \"widowed_divorced\" = \"Widowed/Divorced\"\n)\n\n# Modify the plot code\np_labour_outliers &lt;- ggplot(work_outliers, \n                            aes(x = year, y = labour_force, color = age_band)) + \n  geom_line(linewidth = 0.8, alpha = 0.7) +\n  geom_point(data = filter(work_outliers, is_outlier),\n             color = \"red\", size = 2, shape = 21, fill = \"white\") +\n  facet_wrap(~marital_status, scales = \"free_y\", ncol = 3, labeller = labeller(marital_status = status_labels)) +\n  labs(\n    title = \"Labour Force Trends with Outlier Detection (Female)\",\n    subtitle = \"Red circles indicate statistical outliers using IQR method\",\n    x = \"Year\", \n    y = \"Labour Force Participation Rate (%)\",\n    color = \"Age Band\", # Color legend for Age Band\n    caption = \"Source: data.gov.sg\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    strip.text = element_text(face = \"bold\"),\n    legend.position = \"right\",  # Keep the legend for Age Band\n    legend.title = element_blank(),  # Remove legend title\n  ) +\n  scale_color_viridis_d(option = \"D\") +  \n  scale_x_continuous(\n    breaks = seq(min(work_outliers$year), max(work_outliers$year), by = 10),  # Set x-axis breaks to 10-year intervals\n    labels = seq(min(work_outliers$year), max(work_outliers$year), by = 10)  # Label the x-axis at 10-year intervals\n  )\n\nprint(p_labour_outliers)\n\n\n\n\n\n\n\n\n\nMajority of the outliers were single and occurred in the early 1990s."
  },
  {
    "objectID": "index.html#data-integration-strategy",
    "href": "index.html#data-integration-strategy",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "6.1 Data Integration Strategy",
    "text": "6.1 Data Integration Strategy\nWe will join the datasets together to create a single tibble that contains all the necessary information for our visualisation. The joined tibble will contain the following columns:\n\nyear: from 1991 to 2022\nage_band: Age bands and “All” which is for total fertility rate\nmarital_status: Marital status of the data point\nfertility_rate: Fertility rate by age band (per thousand females) and total fertility rate (per female)\nuom: Fertility rate unit of measurement\nlabour_status: Labour status of the data point, either “labour_force” or “outside_labour_force”\ncount: Number of females either in workforce or outside workforce (in thousands)\n\n\n6.1.1 Filter to Female Population Only\n\n\nShow Code\n# Filter labour data to only include females\nwork_clean_female &lt;- work_clean |&gt; \n  filter(sex == \"female\") |&gt; \n  select(-sex)\n\nnot_working_clean_female &lt;- not_working_clean |&gt; \n  filter(sex == \"female\") |&gt; \n  select(-sex)\n\ncat(\"✓ Filtered to female population only\\n\")\n\n\n✓ Filtered to female population only\n\n\nShow Code\ncat(\"Working females data shape:\", dim(work_clean_female), \"\\n\")\n\n\nWorking females data shape: 696 4 \n\n\nShow Code\ncat(\"Non-working females data shape:\", dim(not_working_clean_female), \"\\n\")\n\n\nNon-working females data shape: 696 4 \n\n\n\n\n6.1.2 Combine Labour Force Data\nA full_join() is used to combine both work_clean_female and not_working_clean_female tibbles, ensuring that all rows from both tibbles are included to combine the labour force columns. The join is done on the year, marital_status, and age_band columns, common dimensions to both tibbles to prevent any data loss.\n\n\nShow Code\n# Combine female labour and not working into one tibble\nlabour_status_female &lt;- full_join(\n  work_clean_female, \n  not_working_clean_female, \n  by = c(\"year\", \"marital_status\", \"age_band\")\n)\n\ncat(\"✓ Combined labour force data successfully\\n\")\n\n\n✓ Combined labour force data successfully\n\n\nShow Code\ncat(\"Combined labour data shape:\", dim(labour_status_female), \"\\n\")\n\n\nCombined labour data shape: 696 5 \n\n\n\n\n6.1.3 Join with Fertility Data\nA left_join() is used joining the fertility_clean tibble to the labour_status_female tibble, ensuring that all rows from fertility_clean are included. This will allow us to combine and be able to associate fertility rates with labour force participation data.\n\n\nShow Code\n# Join fertility data with labour status data\nfertility_labour_joined &lt;- fertility_clean |&gt;\n  left_join(labour_status_female, by = c(\"year\", \"age_band\"))\n\ncat(\"✓ Joined fertility and labour data successfully\\n\")\n\n\n✓ Joined fertility and labour data successfully\n\n\nShow Code\ncat(\"Joined data shape:\", dim(fertility_labour_joined), \"\\n\")\n\n\nJoined data shape: 672 7 \n\n\n\n\n6.1.4 Transform to Long Format\nConversion of labour_force and outside_labour_force columns to have a single column dictating labour status. Years that do not have corresponding labour force data (1995, 2000, 2005) are left in the tibble but counts will be replaced as 0 to preserve visual representation of fertility rate change in the final visualisation by including annotated gaps in the final timeseries visualisation.\n\n\nShow Code\n# Create final analytical dataset\nfinal_dataset &lt;- fertility_labour_joined |&gt;\n  pivot_longer(\n    cols = c(\"labour_force\", \"outside_labour_force\"),\n    names_to = \"labour_status\",\n    values_to = \"count\"\n  ) |&gt;\n  mutate(\n    count = replace_na(count, 0),  # Replace NA with 0 for missing labour force data\n    fertility_rate = replace_na(fertility_rate, NA_real_)  # Ensure fertility rate is NA where missing\n  ) |&gt;\n  # Retain all years (including missing ones)\n  filter(!is.na(fertility_rate)) \n\n\n\n\n6.1.5 Data Quality Validation\nEvaluate the final_dataset for total number of records, unique values in each column, presence of missing values “NA” (which should only come from marital_status column of 1995, 2000 and 2005 years).\n\n\nShow Code\nsummary_table &lt;- tibble(\n  Column         = names(final_dataset),\n  Total_Records  = nrow(final_dataset),\n  Unique_Values  = sapply(final_dataset, function(x) length(unique(x))),\n  Missing_Values = sapply(final_dataset, function(x) sum(is.na(x)))\n)\n\nif (\"year\" %in% names(final_dataset)) {\n  years_present   &lt;- sort(unique(final_dataset$year[!is.na(final_dataset$year)]))\n  yr_min          &lt;- min(years_present)\n  yr_max          &lt;- max(years_present)\n  full_years      &lt;- seq(yr_min, yr_max)\n  missing_years   &lt;- setdiff(full_years, years_present)\n  missing_txt     &lt;- if (length(missing_years)) {\n    paste(missing_years, collapse = \", \")\n  } else {\n    \"None\"\n  }\n  footer_note &lt;- paste0(\n    \"Year range: \", yr_min, \"–\", yr_max,\n    \" | Missing years: \", \"1995, 2000 & 2005\"\n  )\n} else {\n  footer_note &lt;- NULL\n}\n\n# 4. Render as a gt table with footer\ngt_tbl &lt;- summary_table |&gt;\n  gt() |&gt;\n  cols_label(\n    Column         = md(\"**Column**\"),\n    Total_Records  = md(\"**Total Records**\"),\n    Unique_Values  = md(\"**Unique Values**\"),\n    Missing_Values = md(\"**Missing Values**\")\n  ) |&gt;\n  tab_header(\n    title = \"Dataset Structure & Completeness Overview\"\n  )\n\nif (!is.null(footer_note)) {\n  gt_tbl &lt;- gt_tbl |&gt;\n    tab_source_note(\n      source_note = footer_note\n    )\n}\n\ngt_tbl\n\n\n\n\nTable 4: Summary Table of final_dataset Tibble\n\n\n\n\n\n\n\n\n\nDataset Structure & Completeness Overview\n\n\nColumn\nTotal Records\nUnique Values\nMissing Values\n\n\n\n\nyear\n1344\n30\n0\n\n\nage_band\n1344\n8\n0\n\n\nfertility_rate\n1344\n172\n0\n\n\nuom\n1344\n2\n0\n\n\nmarital_status\n1344\n4\n48\n\n\nlabour_status\n1344\n2\n0\n\n\ncount\n1344\n595\n0\n\n\n\nYear range: 1991–2020 | Missing years: 1995, 2000 & 2005\n\n\n\n\n\n\n\n\n\n\n\n\n\n6.1.6 Create Aggregated Totals for Analysis\nCalculate the total count (e.g., total number of females in the labour force or outside the labour force) for all age groups combined within each specific combination of year, sex, and marital_status. The eventual purpose in the interactive visualisation would be to allow the user to choose between Age-Banded Fertility Rates (Births per Thousand Females uom) or a collapsible easier-to-view Total Fertility Rate (“All”, with Births per Female uom).\n\n\nShow Code\n# Create aggregated totals function for reusability\ncreate_totals &lt;- function(data, value_col) {\n  data |&gt;\n    group_by(year, sex, marital_status) |&gt;\n    summarise(\n      age_band = \"All\",\n      !!value_col := sum(!!sym(value_col), na.rm = TRUE),\n      .groups = \"drop\"\n    )\n}\n\n# Apply to both datasets for comprehensive analysis\nwork_all &lt;- create_totals(work_clean, \"labour_force\")\nnot_working_all &lt;- create_totals(not_working_clean, \"outside_labour_force\")\n\n# Combine with existing data\nwork_complete &lt;- bind_rows(work_clean, work_all)\nnot_working_complete &lt;- bind_rows(not_working_clean, not_working_all)\n\ncat(\"Work data with totals shape:\", dim(work_complete), \"\\n\")\n\n\nWork data with totals shape: 1566 5 \n\n\nShow Code\ncat(\"Not working data with totals shape:\", dim(not_working_complete), \"\\n\")\n\n\nNot working data with totals shape: 1566 5"
  },
  {
    "objectID": "index.html#dataset-integration-results",
    "href": "index.html#dataset-integration-results",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "6.2 Dataset Integration Results",
    "text": "6.2 Dataset Integration Results\nThe final integrated dataset successfully combines:\n\nFertility rates from SingStat (1991-2022)\nFemale labour force participation from data.gov.sg\nDemographic breakdowns by age group and marital status in time series\n\nThis integrated dataset forms the foundation for our comprehensive analysis of Singapore’s fertility crisis and its relationship with socioeconomic factors. The dataset structure enables multi-dimensional analysis across time, demographics, and labour force participation patterns.\n\n\nShow Code\ndatatable(\n  final_dataset,\n  class    = \"compact stripe hover\",   # make rows & font more compact\n  extensions = 'Buttons',\n  filter     = \"none\",   # turn off per-column filters\n  options = list(\n    pageLength = 6,\n    scrollX    = TRUE,\n    dom        = 'Bfrtip',                # Buttons, global filter, table, info, pagination\n    buttons    = list(\n      list(extend = 'csv', text = 'Export CSV')\n    )\n  ),\n  rownames = FALSE\n)\n\n\n\n\nTable 5: Preview of final_dataset"
  },
  {
    "objectID": "index.html#lower-level-dodged-plot",
    "href": "index.html#lower-level-dodged-plot",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "7.1 Lower Level Dodged Plot",
    "text": "7.1 Lower Level Dodged Plot\nUse this visualisation for detailed inspection of fertility and female population labour participation trends by age-bands.\n\n\nShow Code\n# Load and clean data\nfiltered_dataset &lt;- final_dataset |&gt;\n  filter(age_band != \"All\") |&gt;\n  mutate(\n    marital_status  = tools::toTitleCase(trimws(as.character(marital_status))),\n    labour_status   = tools::toTitleCase(trimws(as.character(labour_status))),\n    age_band        = tools::toTitleCase(trimws(as.character(age_band))),\n    count           = as.numeric(as.character(count)),\n    fertility_rate  = as.numeric(as.character(fertility_rate)),\n    uom             = ifelse(age_band == \"All\", \"per female\", \"per thousand females\")  # Adding the unit of measurement column\n  )\n\n# Calculate the aggregated total count for each year, marital status, and labour status\naggregated_data &lt;- filtered_dataset |&gt;\n  group_by(year, marital_status, labour_status) |&gt;\n  summarise(total_count = sum(count, na.rm = TRUE), .groups = \"drop\")\n\n# Merge the aggregated total count with the original data\nfiltered_dataset &lt;- filtered_dataset |&gt;\n  left_join(aggregated_data, by = c(\"year\", \"marital_status\", \"labour_status\"))\n\n# SharedData for interactivity\nshared_data &lt;- SharedData$new(filtered_dataset, group = \"full_filter\")\n\n# Filter controls\nfilter_marital &lt;- filter_select(\"filter_marital\", \"Marital Status:\", shared_data, ~marital_status)\nfilter_labour  &lt;- filter_select(\"filter_labour\", \"Labour Status:\", shared_data, ~labour_status)\nfilter_ageband &lt;- filter_select(\"filter_ageband\", \"Age Band:\", shared_data, ~age_band)\n\nfilter_year &lt;- filter_slider(\n  \"filter_year\", \n  \"Select Year Range:\", \n  shared_data, \n  ~year, \n  step = 1  # Ensures the slider increments by 1 year at a time\n)\n\n# Custom Colors for Marital Status\nmarital_colors &lt;- c(\n  \"Single\" = \"#32CD32\",  # Light Green\n  \"Married\" = \"#1E90FF\",  # Dodger Blue\n  \"Widowed_divorced\" = \"#FF4500\"  # Orange Red\n)\n\n# Custom Colors for Age Bands\nage_colors &lt;- setNames(brewer.pal(length(unique(filtered_dataset$age_band)), \"Dark2\"),\n                       unique(filtered_dataset$age_band))\n\n# Scaling factor\nscale_factor &lt;- max(filtered_dataset$count, na.rm = TRUE) / max(filtered_dataset$fertility_rate, na.rm = TRUE)\n\n# Generate HTML for the custom legend\nage_bands &lt;- na.omit(unique(filtered_dataset$age_band))  # Get unique age bands (excluding NA)\n\n# Split age bands into two columns (first 4 in col1, next in col2)\ncol1_bands &lt;- head(age_bands, 4)\ncol2_bands &lt;- tail(age_bands, length(age_bands) - 4)\n\n# Create HTML for both columns\ncol1_html &lt;- paste0(\n  sapply(col1_bands, function(b) {\n    sprintf('&lt;div style=\"display: flex; align-items: center; gap: 5px; margin-bottom: 5px;\"&gt;\n               &lt;div style=\"width: 15px; height: 15px; background-color: %s; border-radius: 3px;\"&gt;&lt;/div&gt;\n               &lt;span&gt;%s&lt;/span&gt;\n             &lt;/div&gt;', age_colors[b], b)\n  }), \n  collapse = \"\"\n)\n\ncol2_html &lt;- paste0(\n  sapply(col2_bands, function(b) {\n    sprintf('&lt;div style=\"display: flex; align-items: center; gap: 5px; margin-bottom: 5px;\"&gt;\n               &lt;div style=\"width: 15px; height: 15px; background-color: %s; border-radius: 3px;\"&gt;&lt;/div&gt;\n               &lt;span&gt;%s&lt;/span&gt;\n             &lt;/div&gt;', age_colors[b], b)\n  }), \n  collapse = \"\"\n)\n\n# Combined legend template\ncombined_legend &lt;- sprintf('\n&lt;div style=\"display: flex; width: 100%%; gap: 15px; margin-top: 20px; font-family: Arial, sans-serif;\"&gt;\n  &lt;!-- Marital Status (1/3 width) --&gt;\n  &lt;div style=\"flex: 1; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Marital Status&lt;/div&gt;\n    &lt;div style=\"display: flex; flex-direction: column; gap: 6px;\"&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #32CD32; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Single&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #1E90FF; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Married&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #FF4500; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Widowed/Divorced&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  \n  &lt;!-- Age Bands (2/3 width) --&gt;\n  &lt;div style=\"flex: 2; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Age Band&lt;/div&gt;\n    &lt;div style=\"display: flex; gap: 15px;\"&gt;\n      &lt;div style=\"flex: 1;\"&gt;%s&lt;/div&gt;\n      &lt;div style=\"flex: 1;\"&gt;%s&lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n', col1_html, col2_html)\n\n# Plot\np &lt;- ggplot() +\n  geom_col(\n    data = shared_data,\n    aes(\n      x = factor(year),\n      y = count,\n      fill = marital_status,  # Segments by marital status\n      group = interaction(labour_status, marital_status),  # Ensure the bars are grouped by both labour and marital status\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Marital Status: \", marital_status,\n        \"&lt;br&gt;Labour Status: \", labour_status,\n        \"&lt;br&gt;Age Band: \", age_band,  # Adding age band to the bars' tooltip\n        \"&lt;br&gt;Count: \", comma(count),\n        \"&lt;br&gt;Total: \", comma(total_count)  # Adding aggregated total count to the tooltip\n      )\n    ),\n    position = position_dodge(width = 0.7),  # Keep the dodge position\n    width = 0.6,\n    colour = \"white\",\n    size = 0.2,\n    alpha = 0.6  # Reduced alpha for better visibility of segments\n  ) +\n  geom_line(\n    data = shared_data,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor,\n      group = age_band,\n      colour = age_band\n    ),\n    size = 0.8,  # Reduced line size for a more subtle appearance\n    alpha = 0.6  # Reduced alpha for the line\n  ) +\n  geom_point(\n    data = shared_data,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor,\n      group = age_band,\n      colour = age_band,\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Age Band: \", age_band,\n        \"&lt;br&gt;Fertility Rate: \", round(fertility_rate, 2),\n        \"&lt;br&gt;Unit: \", uom  # Added the unit of measurement (uom) to the hover tooltip\n      )\n    ),\n    size = 0.5,  # Reduced point size\n    alpha = 0.6  # Reduced point alpha for subtlety\n  ) +\n  scale_fill_manual(values = marital_colors) +  # Apply custom colors for marital status\n  scale_colour_manual(values = age_colors) +  # Apply custom colors for age bands\n  scale_y_continuous(\n    name = \"Female Population (thousands)\",\n    labels = comma\n  ) +\n  labs(\n    title = \"Fertility Rates vs Labour Participation\",\n    subtitle = \"Bars: Segmented by Marital Status; Points: Fertility Rates by Age Band\",\n    x = \"Year\",\n    caption = \"Source: SingStat & data.gov.sg\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    legend.position = \"none\"  # No legend for now, as we've defined the colors manually\n  )\n\n# Plotly conversion (only points have tooltips)\nplotly_output &lt;- ggplotly(p, tooltip = \"text\")  # Ensures the custom text in tooltips is used\n\n# Add vertical annotations for the years without data (1995, 2000, 2005)\nplotly_output &lt;- plotly_output |&gt; \n  layout(\n    annotations = list(\n      list(\n        x = 5, y = 0, # for 1995 annotation\n        text = \"No Data\", \n        showarrow = FALSE,\n        font = list(size = 12, color = \"black\", family = \"Arial\"),\n        textangle = 90,  # Rotate text vertically\n        xanchor = \"center\",\n        yanchor = \"bottom\"\n      ),\n      list(\n        x = 10, y = 0, # for 2000 annotation\n        text = \"No Data\", \n        showarrow = FALSE,\n        font = list(size = 12, color = \"black\", family = \"Arial\"),\n        textangle = 90,  # Rotate text vertically\n        xanchor = \"center\",\n        yanchor = \"bottom\"\n      ),\n      list(\n        x = 15, y = 0, # for 2005 annotation\n        text = \"No Data\", \n        showarrow = FALSE,\n        font = list(size = 12, color = \"black\", family = \"Arial\"),\n        textangle = 90,  # Rotate text vertically\n        xanchor = \"center\",\n        yanchor = \"bottom\"\n      )\n    )\n  )\n\n# Final UI Layout with Footnote\ntagList(\n  div(\n    style = \"margin-bottom:20px;\",\n    h3(\"Interactive Fertility & Labour Plot\"),\n    p(\"Use filters to explore age-banded female labour force counts and age-banded fertility rates.\")\n  ),\n  div(\n    style = \"display: flex; gap: 15px; margin-bottom: 20px;\",\n    filter_marital,\n    filter_labour,\n    filter_ageband\n  ),\n  div(\n    style = \"margin-bottom: 20px;\",\n    filter_year  # Add the year slider to the layout\n  ),\n  plotly_output,\n  \n  # Footnote Section\n  div(\n    style = \"margin-top: 20px; font-size: 12px; color: #555; text-align: center;\",\n    p(\"Population data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years.\"),\n    p(\"Source: data.gov.sg & SingStat\")\n  ),\n  \n  # Custom Legend Section\n  HTML(combined_legend)  # Display the custom legend\n)\n\n\n\nInteractive Fertility & Labour Plot\nUse filters to explore age-banded female labour force counts and age-banded fertility rates.\n\n\n\nMarital Status:\n\n\n\n\n\n\nLabour Status:\n\n\n\n\n\n\nAge Band:\n\n\n\n\n\n\n\n\nSelect Year Range:\n\n\n\n\n\n\n\nPopulation data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years.\nSource: data.gov.sg & SingStat\n\n\n\n  \n  \n    Marital Status\n    \n      \n        \n        Single\n      \n      \n        \n        Married\n      \n      \n        \n        Widowed/Divorced\n      \n    \n  \n  \n  \n  \n    Age Band\n    \n      \n               \n               15-19\n             \n               \n               20-24\n             \n               \n               25-29\n             \n               \n               30-34\n             \n      \n               \n               35-39\n             \n               \n               40-44\n             \n               \n               45-49\n             \n    \n  \n\n\n\n\nSummary of Improvements to weaknesses\n\nExtended Analysis: Compared to the 2019–2023 analysis of the original, our visualisation expands the scope to fertility rates from 1991 to 2022.\nSocio-Economic Factors: The original visualisation lacked explanatory power for Singapore’s fertility decline. This plot introduces dimensions like female population by age-bands allowing users to evaluate female labour status, and marital status to reveal potential causal relationships between these and fertility rates.\nAge-Banded Fertility: Instead of a single total fertility rate, this allows the user to inspect age-banded fertility rates for age bands 15–49 in 5-year increments. This highlights how fertility behaviour shifts across cohorts potentially unveiling the reasons behind Singapore’s declining fertility rate."
  },
  {
    "objectID": "index.html#higher-level-dodged-plot",
    "href": "index.html#higher-level-dodged-plot",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "7.2 Higher Level Dodged Plot",
    "text": "7.2 Higher Level Dodged Plot\nUse this visualisation to inspect aggregated totals of female population and fertility rates that are not separated by age bands.\n\n\nShow Code\nfiltered_dataset &lt;- final_dataset |&gt;\n  filter(age_band == \"All\") |&gt;\n  mutate(\n    marital_status  = tools::toTitleCase(trimws(as.character(marital_status))),\n    labour_status   = tools::toTitleCase(trimws(as.character(labour_status))),\n    age_band        = tools::toTitleCase(trimws(as.character(age_band))),\n    count           = as.numeric(as.character(count)),\n    fertility_rate  = as.numeric(as.character(fertility_rate)),\n    uom             = ifelse(age_band == \"All\", \"per female\", \"per thousand females\")  # Adding the unit of measurement column\n  )\n\n# SharedData for interactivity\nshared_data &lt;- SharedData$new(filtered_dataset, group = \"full_filter\")\n\n# Filter controls\nfilter_marital &lt;- filter_select(\"filter_marital\", \"Marital Status:\", shared_data, ~marital_status)\nfilter_labour  &lt;- filter_select(\"filter_labour\", \"Labour Status:\", shared_data, ~labour_status)\nfilter_ageband &lt;- filter_select(\"filter_ageband\", \"Age Band:\", shared_data, ~age_band)\n\nfilter_year &lt;- filter_slider(\n  \"filter_year\", \n  \"Select Year Range:\", \n  shared_data, \n  ~year, \n  step = 1  # Ensures the slider increments by 1 year at a time\n)\n\n# Custom Colors for Marital Status\nmarital_colors &lt;- c(\n  \"Single\" = \"#32CD32\",  # Light Green\n  \"Married\" = \"#1E90FF\",  # Dodger Blue\n  \"Widowed_divorced\" = \"#FF4500\"  # Orange Red\n)\n\n# Custom Colors for Age Bands\nage_colors &lt;- setNames(brewer.pal(length(unique(filtered_dataset$age_band)), \"Dark2\"),\n                       unique(filtered_dataset$age_band))\n\n# Scaling factor\nscale_factor &lt;- max(filtered_dataset$count, na.rm = TRUE) / max(filtered_dataset$fertility_rate, na.rm = TRUE)\n\n# Generate HTML for the custom legend\nage_bands &lt;- na.omit(unique(filtered_dataset$age_band))  # Get unique age bands (excluding NA)\n\n# Split age bands into two columns (first 4 in col1, next in col2)\ncol1_bands &lt;- head(age_bands, 4)\ncol2_bands &lt;- tail(age_bands, length(age_bands) - 4)\n\n# Create HTML for both columns\ncol1_html &lt;- paste0(\n  sapply(col1_bands, function(b) {\n    sprintf('&lt;div style=\"display: flex; align-items: center; gap: 5px; margin-bottom: 5px;\"&gt;\n               &lt;div style=\"width: 15px; height: 15px; background-color: %s; border-radius: 3px;\"&gt;&lt;/div&gt;\n               &lt;span&gt;%s&lt;/span&gt;\n             &lt;/div&gt;', age_colors[b], b)\n  }), \n  collapse = \"\"\n)\n\ncol2_html &lt;- paste0(\n  sapply(col2_bands, function(b) {\n    sprintf('&lt;div style=\"display: flex; align-items: center; gap: 5px; margin-bottom: 5px;\"&gt;\n               &lt;div style=\"width: 15px; height: 15px; background-color: %s; border-radius: 3px;\"&gt;&lt;/div&gt;\n               &lt;span&gt;%s&lt;/span&gt;\n             &lt;/div&gt;', age_colors[b], b)\n  }), \n  collapse = \"\"\n)\n\n# Combined legend template\ncombined_legend &lt;- sprintf('\n&lt;div style=\"display: flex; width: 100%%; gap: 15px; margin-top: 20px; font-family: Arial, sans-serif;\"&gt;\n  &lt;!-- Marital Status (1/3 width) --&gt;\n  &lt;div style=\"flex: 1; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Marital Status&lt;/div&gt;\n    &lt;div style=\"display: flex; flex-direction: column; gap: 6px;\"&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #32CD32; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Single&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #1E90FF; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Married&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #FF4500; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Widowed/Divorced&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  \n  &lt;!-- Age Bands (2/3 width) --&gt;\n  &lt;div style=\"flex: 2; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Age Band&lt;/div&gt;\n    &lt;div style=\"display: flex; gap: 15px;\"&gt;\n      &lt;div style=\"flex: 1;\"&gt;%s&lt;/div&gt;\n      &lt;div style=\"flex: 1;\"&gt;%s&lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n', col1_html, col2_html)\n\nshared_data_lines_points &lt;- SharedData$new(\n  filtered_dataset |&gt; filter(!(year %in% c(1995, 2000, 2005))),\n  group = \"full_filter\"\n)\n\n# Plot\np &lt;- ggplot() +\n  geom_col(\n    data = shared_data,\n    aes(\n      x = factor(year),\n      y = count,\n      fill = marital_status,  # Segments by marital status\n      group = interaction(labour_status, marital_status),  # Ensure the bars are grouped by both labour and marital status\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Marital Status: \", marital_status,\n        \"&lt;br&gt;Labour Status: \", labour_status,\n        \"&lt;br&gt;Female Population: \", comma(count)\n      )\n    ),\n    position = position_dodge(width = 0.7),  # Keep the dodge position\n    width = 0.6,\n    colour = \"white\",\n    size = 0.2,\n    alpha = 0.6  # Reduced alpha for better visibility of segments\n  ) +\n  geom_line(\n    data = shared_data_lines_points,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor,\n      group = age_band,\n      colour = age_band\n    ),\n    size = 0.8,  # Reduced line size for a more subtle appearance\n    alpha = 0.6  # Reduced alpha for the line\n  ) +\n  geom_point(\n    data = shared_data_lines_points,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor,\n      group = age_band,\n      colour = age_band,\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Fertility Rate: \", round(fertility_rate, 2),\n        \"&lt;br&gt;Unit: \", uom  # Added the unit of measurement (uom) to the hover tooltip\n      )\n    ),\n    size = 0.5,  # Reduced point size\n    alpha = 0.6  # Reduced point alpha for subtlety\n  ) +\n  scale_fill_manual(values = marital_colors) +  # Apply custom colors for marital status\n  scale_colour_manual(values = age_colors) +  # Apply custom colors for age bands\n  scale_y_continuous(\n    name = \"Female Population (thousands)\",\n    labels = comma\n  ) +\n  labs(\n    title = \"Fertility Rates vs Labour Participation\",\n    subtitle = \"Bars: Segmented by Marital Status; Points: Fertility Rates by Age Band\",\n    x = \"Year\",\n    caption = \"Source: SingStat & data.gov.sg\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    legend.position = \"none\"  # No legend for now, as we've defined the colors manually\n  )\n\n# Plotly conversion (only points have tooltips)\nplotly_output &lt;- ggplotly(p, tooltip = \"text\")  # Ensures the custom text in tooltips is used\n\n# Add vertical annotations for the years without data (1995, 2000, 2005)\nplotly_output &lt;- plotly_output |&gt; \n  layout(\n    annotations = list(\n      list(\n        x = 5, y = 0, # for 1995 annotation\n        text = \"No Data\", \n        showarrow = FALSE,\n        font = list(size = 12, color = \"black\", family = \"Arial\"),\n        textangle = 90,  # Rotate text vertically\n        xanchor = \"center\",\n        yanchor = \"bottom\"\n      ),\n      list(\n        x = 10, y = 0, # for 2000 annotation\n        text = \"No Data\", \n        showarrow = FALSE,\n        font = list(size = 12, color = \"black\", family = \"Arial\"),\n        textangle = 90,  # Rotate text vertically\n        xanchor = \"center\",\n        yanchor = \"bottom\"\n      ),\n      list(\n        x = 15, y = 0, # for 2005 annotation\n        text = \"No Data\", \n        showarrow = FALSE,\n        font = list(size = 12, color = \"black\", family = \"Arial\"),\n        textangle = 90,  # Rotate text vertically\n        xanchor = \"center\",\n        yanchor = \"bottom\"\n      )\n    )\n  )\n\n# Final UI Layout with Footnote\ntagList(\n  div(\n    style = \"margin-bottom:20px;\",\n    h3(\"Interactive Fertility & Labour Plot\"),\n    p(\"Use filters to explore age-banded female labour force counts and age-banded fertility rates.\")\n  ),\n  div(\n    style = \"display: flex; gap: 15px; margin-bottom: 20px;\",\n    filter_marital,\n    filter_labour\n  ),\n  div(\n    style = \"margin-bottom: 20px;\",\n    filter_year  # Add the year slider to the layout\n  ),\n  plotly_output,\n  \n  # Footnote Section\n  div(\n    style = \"margin-top: 20px; font-size: 12px; color: #555; text-align: center;\",\n    p(\"Population data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years.\"),\n    p(\"Source: data.gov.sg & SingStat\")\n  ),\n  \n  # Custom Legend Section\n  HTML(combined_legend)  # Display the custom legend\n)\n\n\n\nInteractive Fertility & Labour Plot\nUse filters to explore age-banded female labour force counts and age-banded fertility rates.\n\n\n\nMarital Status:\n\n\n\n\n\n\nLabour Status:\n\n\n\n\n\n\n\n\nSelect Year Range:\n\n\n\n\n\n\n\nPopulation data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years.\nSource: data.gov.sg & SingStat\n\n\n\n  \n  \n    Marital Status\n    \n      \n        \n        Single\n      \n      \n        \n        Married\n      \n      \n        \n        Widowed/Divorced\n      \n    \n  \n  \n  \n  \n    Age Band\n    \n      \n               \n               All\n             \n      \n    \n  \n\n\n\n\nSummary of Improvements to weaknesses\n\nExtended Analysis: Compared to the 2019–2023 analysis of the original, our visualisation expands the scope to fertility rates from 1991 to 2022.\nSocio-Economic Factors: This provides an alternative overall perspective into how marital and labour status of females in Singapore is affecting total fertility rates. This plot is meant to reduce visual clutter by removing the dimension of age-bands."
  },
  {
    "objectID": "index.html#faceted-dashboard",
    "href": "index.html#faceted-dashboard",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "7.2 Faceted Dashboard",
    "text": "7.2 Faceted Dashboard\n\n\nShow Code\n# Compute agg_counts and filter out \"All\" age band\nagg_counts &lt;- final_dataset |&gt;\n  filter(age_band != \"All\") |&gt;  # Ensure \"All\" is excluded here\n  group_by(year, marital_status, labour_status) |&gt;\n  summarise(count = sum(count, na.rm = TRUE), .groups=\"drop\")\n\n\n# Prepare bar tooltips and IDs\ntooltip_df &lt;- agg_counts |&gt;\n  pivot_wider(\n    names_from  = labour_status,\n    values_from = count,\n    values_fill = list(count=0)\n  ) |&gt;\n  rename(in_LF = labour_force, out_LF = outside_labour_force) |&gt;\n  mutate(\n    tooltip = paste0(\n      \"Year: \", year, \"&lt;br/&gt;\",\n      \"Marital Status: \", marital_status, \"&lt;br/&gt;\",\n      \"In LF: \", comma(in_LF), \"k&lt;br/&gt;\",\n      \"Out LF: \", comma(out_LF), \"k\"\n    ),\n    # This is the unique ID for each bar‐pair\n    bar_id = paste(year, marital_status)\n  ) |&gt;\n  pivot_longer(\n    cols      = c(in_LF, out_LF),\n    names_to  = \"labour_status\",\n    values_to = \"count\"\n  ) |&gt;\n  mutate(\n    labour_status = recode(\n      labour_status,\n      in_LF  = \"labour_force\",\n      out_LF = \"outside_labour_force\"\n    )\n  ) |&gt;\n  filter(!is.na(marital_status))  # Ensure that NA is excluded\n\n\n# Compute fertility_ab & give each point 'all' bar_ids for its year\n# Get all marital_status values\nall_status &lt;- unique(agg_counts$marital_status)\n\nfertility_ab &lt;- final_dataset |&gt;\n  filter(age_band != \"All\") |&gt;\n  distinct(year, age_band, fertility_rate) |&gt;\n  arrange(age_band, year) |&gt;\n  group_by(age_band) |&gt;\n  mutate(\n    # Ensure uom column is added here\n    uom = ifelse(age_band == \"All\", \"per female\", \"per thousand females\"),\n    tooltip = paste0(\n      \"Year: \", year, \"&lt;br/&gt;\",\n      \"Age Band: \", age_band, \"&lt;br/&gt;\",\n      \"Fertility Rate: \", round(fertility_rate, 2), \"&lt;br/&gt;\",\n      \"Unit: \", uom  # Include unit of measurement in tooltip\n    ),\n    # Build a space-separated string of 'all' status‐specific IDs for that year\n    data_id = map_chr(year, ~ paste(paste(.x, all_status), collapse=\" \"))\n  ) |&gt;\n  ungroup()\n\n# Build bar_plot with interactive elements\nbar_plot &lt;- ggplot(tooltip_df) +\n  geom_col_interactive(\n    aes(\n      x       = year,\n      y       = count,\n      fill    = marital_status,\n      data_id = bar_id,\n      tooltip = tooltip\n    ),\n    position = position_dodge(width=0.8),\n    alpha    = 0.8\n  ) +\n  scale_y_continuous(name=\"Female Population (thousands)\", labels=comma) +\n  scale_fill_brewer(palette=\"Set1\", name=\"Marital Status\", na.translate = FALSE) +  # Exclude NA from the legend\n  facet_wrap(~ labour_status, ncol=1,\n             labeller = labeller(\n               labour_status = c(\n                 labour_force         = \"In Labour Force\",\n                 outside_labour_force = \"Outside Labour Force\"\n               )\n             )) +\n  theme_minimal(base_size=10) +\n  theme(legend.position=\"bottom\",\n        strip.text=element_text(face=\"bold\", size=12)) +\n  # Add \"No Data\" annotation for 1995, 2000, and 2005\n  geom_text(data = data.frame(\n    year = c(1995, 2000, 2005),\n    count = 0,\n    marital_status = \"No Data\",  # Dummy for annotation\n    label = \"No Data\"\n  ), aes(x = year, y = count, label = label),\n    angle = 90,  # Vertical text\n    vjust = 0,  # Adjust text position\n    nudge_y = 80, # up abit\n    size = 3, color = \"black\", fontface = \"bold\"\n  )\n\n\n# Build fertility_rate line plot (no scaling factor applied to fertility_rate)\nline_plot &lt;- ggplot(fertility_ab) +\n  geom_line_interactive(\n    aes(\n      x       = year,\n      y       = fertility_rate,  # Removed scaling factor here\n      colour  = age_band,\n      group   = age_band,\n      data_id = data_id,\n      tooltip = tooltip\n    ), size=1\n  ) +\n  geom_point_interactive(\n    aes(\n      x       = year,\n      y       = fertility_rate,  # Removed scaling factor here\n      colour  = age_band,\n      group   = age_band,\n      data_id = data_id,\n      tooltip = tooltip\n    ), size=3\n  ) +\n  scale_y_continuous(name=\"Fertility Rate\", labels=comma) +  # Removed the scale factor in axis label\n  scale_colour_brewer(palette=\"Set2\", name=\"Age Band\") +\n  theme_minimal(base_size=10) +\n  theme(legend.position=\"bottom\",\n        strip.text=element_text(face=\"bold\", size=12))\n\n# Combine & render\ncombined_plot &lt;- bar_plot + line_plot + plot_layout(ncol=1, heights=c(2,1))\n\n# Add footnote text as caption\nfootnote &lt;- \"Population data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years. Source: data.gov.sg & SingStat\"\n\n# Create ggiraph plot\ngir &lt;- girafe(\n  ggobj     = combined_plot +\n    labs(\n      caption = footnote  # Add footnote as caption\n    ) +\n    theme(\n      plot.caption = element_text(hjust = 0)  # Move caption to the left\n    ),\n  width_svg = 12,\n  height_svg= 8,\n  options   = list(\n    opts_hover(css=\"stroke-width:0.3px;opacity:2;\"),\n    opts_hover_inv(css=\"opacity:0.2;\"),\n    opts_selection(type=\"multiple\", only_shiny=FALSE,\n                   css=\"stroke:black;stroke-width:0.3px;opacity:2;\"),\n    opts_selection_inv(css=\"opacity:0.2;\"),\n    opts_zoom(max=5, min=1)\n  )\n)\n\ngir\n\n\n\n\n\n\nSummary of Improvements:\n\nUnified selection IDs: Used a single data_id = paste0(“year_”, year) for both bars and lines, when clicking a year it highlights all elements for that year\nprovides an alternative to the higher level dodged plot which allows user to inspect aggregated totals of female population in and out of labour force and uses age banded fertility rates and not total fertility rate.\n\nImproved interactivity:\n\nChanged to single‐click selection (opts_selection(type=“single”)), where user can select multiple data points (bars or points) to inspect. Alternatively they may use the lasso select tooptip for area selection.\nAdded custom tooltip styling, zooming, panning or hovering effect and information display (female population in LF and out LF as well as fertility rates)."
  },
  {
    "objectID": "index.html#summary-statistics",
    "href": "index.html#summary-statistics",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "9.1 Summary Statistics",
    "text": "9.1 Summary Statistics\nThe integrated dataset reveals four headline insights:\n1. Female labour participation is the dominant macro-driver.\n- A 1 pp rise in the female labour-participation rate (LFPR) is associated with a ≈0.022 drop in the total-fertility rate (TFR).\n2. The fertility crash is concentrated in the peak 25 – 29 age-band.\n- From 1991 to 2022 their age-specific fertility rate fell 55 %, two-and-a-half times faster than any other band.\n3. Singlehood magnifies the effect.\n- Single women outside the labour force contribute &lt; 5 % of births in every year after 2010, signalling a shrinking “catch-up” potential.\n4. 1998 is the structural break.\n- A Chow test around the Asian Financial Crisis confirms a statistically significant change in the slope of TFR (p &lt; 0.01).\n\n\n\n\nTable 7: Fertility & Female Labour Participation Rates\n\n\n\n\n\n\n\n\n\nFertility & LFPR by Decade\n\n\nDecade\nMean TFR\nSD\nMean LFPR\n\n\n\n\n1990s\n1.64\n0.10\n0.588\n\n\n2000s\n1.32\n0.11\n0.634\n\n\n2010s\n1.20\n0.05\n0.699\n\n\n2020-22\n1.10\nNA\n0.735\n\n\n\n\n\n\n\n\n\n\n\n9.1.1 Insights from the table\nTrends across decades\n\nSteady fertility decline: 1.64 ➜ 1.32 ➜ 1.20 ➜ 1.10. The 2020-22 figure is barely half of the replacement level (≈ 2.1).\nRising female participation: 0.588 ➜ 0.634 ➜ 0.699 ➜ 0.735. Roughly 15 percentage-points more women are in paid work than in the 1990s.\nGreater stability at low fertility: The SD shrinks from 0.11 to 0.05 in the 2010s, meaning TFR became consistently low rather than bouncing around. (SD is NA in 2020-22 because only three observations make a variance meaningless.)\n\nWhat this suggests\n\nInverse relationship: Every decade that female LFPR rises, TFR falls—mirroring the strong negative correlation (≈ -0.87) we calculated earlier.\n1990s → 2000s step-change: The sharpest TFR drop (-0.34) coincides with the first big LFPR jump (+4.6 pp), reinforcing labour-market pressure on family formation.\nLock-in of low fertility: Once TFR slipped below 1.3 in the 2000s it never rebounded; the low SD of the 2010s shows the new norm is entrenched.\nPolicy implication: Reversing the decline likely demands measures that let women reconcile full-time work with earlier child-bearing (e.g., affordable childcare, flexible jobs), not merely incentives to have more children\n\nOverall, the table compresses thirty years of data into a single glance: as Singaporean women joined the workforce in ever-greater numbers, fertility fell phase by phase and has now stabilised at record lows."
  },
  {
    "objectID": "index.html#statistical-significance-testing",
    "href": "index.html#statistical-significance-testing",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "9.2 Statistical Significance Testing",
    "text": "9.2 Statistical Significance Testing\nPearson r Test: Measures the strength and direction of the linear relationship between two continuous variables. In this case, it quantifies how closely the female labour-force-participation rate (LFPR) and the total fertility rate (TFR) move together in a straight line.\nLM Slope (from TFR ~ LFPR): Fits a simple linear regression model to estimate the quantitative impact (slope) of one variable (LFPR) on another (TFR). It tells you the expected change in TFR for a one-unit change in LFPR and assesses the statistical significance of this relationship.\nKruskal–Wallis Test: A non-parametric test used to determine if there are statistically significant differences in the distributions of a continuous variable (fertility rate) across three or more independent groups (age bands).\nChow F (1998 break): Tests for a structural break in a regression model at a known point in time (1998). It checks whether the relationship between TFR and LFPR (the slope and/or intercept of the regression line) changed significantly before and after the Asian Crisis.\np-value is a probability that measures the strength of evidence against a null hypothesis “no effect” obtained from the data (Scribbr, 2025).\n\n\nShow Code\n# Build correlation_data (year-level)\ncorrelation_data &lt;- final_dataset |&gt;                  # uses long data\n  filter(age_band == \"All\") |&gt;                        # total fertility only\n  group_by(year, labour_status) |&gt;                    \n  summarise(\n    fertility_rate = first(fertility_rate),\n    total_count    = sum(count, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |&gt; \n  pivot_wider(\n    names_from  = labour_status,\n    values_from = total_count\n  ) |&gt; \n  mutate(\n    labour_participation_rate = labour_force /\n                                (labour_force + outside_labour_force),\n    total_female_population   = labour_force + outside_labour_force\n  ) |&gt; \n  arrange(year)\n\n# Statistical tests\n## Pearson correlation\ncor_test &lt;- cor.test(\n  correlation_data$fertility_rate,\n  correlation_data$labour_participation_rate,\n  method = \"pearson\"\n)\n\n## Simple linear model\nlm_fit   &lt;- lm(fertility_rate ~ labour_participation_rate, data = correlation_data)\nlm_tidy  &lt;- tidy(lm_fit)\nlm_glance&lt;- glance(lm_fit)\n\n## Kruskal–Wallis (fertility ~ age_band)\nkw_test  &lt;- final_dataset |&gt; \n  filter(age_band != \"All\") |&gt; \n  kruskal.test(fertility_rate ~ age_band, data = .)\n\n## Chow structural-break test at 1998\nchow &lt;- sctest(\n  fertility_rate ~ labour_participation_rate,\n  type  = \"Chow\",\n  point = which(correlation_data$year == 1998),\n  data  = correlation_data\n)\n\n# Assemble results for display \ntest_results &lt;- tibble(\n  Test          = c(\"Pearson r\", \"LM slope\", \"Kruskal–Wallis H\", \"Chow F\"),\n  Statistic     = c(\n    round(cor_test$estimate, 3),\n    round(lm_tidy$estimate[2], 3),\n    round(kw_test$statistic, 2),\n    round(chow$statistic, 2)\n  ),\n  `p-value`     = c(\n    format.pval(cor_test$p.value),\n    format.pval(lm_tidy$p.value[2]),\n    format.pval(kw_test$p.value),\n    format.pval(chow$p.value)\n  ),\n  Interpretation = c(\n    \"Strength & direction of association\",\n    \"Slope of TFR ~ LFPR\",\n    \"Differences across age bands\",\n    \"Structural break at 1998\"\n  )\n)\n\ngt(test_results)\n\n\n\n\nTable 8: Statistical Significance Test Results\n\n\n\n\n\n\n\n\n\nTest\nStatistic\np-value\nInterpretation\n\n\n\n\nPearson r\n-0.875\n0.0000000023151\nStrength & direction of association\n\n\nLM slope\n-3.447\n0.0000000023151\nSlope of TFR ~ LFPR\n\n\nKruskal–Wallis H\n6515.850\n&lt; 0.000000000000000222\nDifferences across age bands\n\n\nChow F\n37.310\n0.000000060209\nStructural break at 1998\n\n\n\n\n\n\n\n\n\n\nPearson r Test - A very strong inverse linear association between female labour-force-participation rate (LFPR) and total fertility rate (TFR). As women’s LFPR rises, TFR falls almost in lock-step.\nLM Slope - From the simple regression TFR ~ LFPR. A one-unit (i.e., 100 percentage-point) rise in LFPR would predict a 3.447 drop in TFR; scaled more realistically, each 10 pp rise in LFPR decreases TFR by about 0.345. The slope is highly significant, confirming that LFPR is a strong linear predictor of fertility.\nKruskal–Wallis Test - A non-parametric test comparing fertility distributions across age bands. The enormous H statistic and vanishingly small p-value tell us the age groups do not share a common median fertility rate—fertility behaviour differs sharply by age band.\nChow F (1998 break) - Tests whether the 1998 Asian-Crisis year marks a structural change in the TFR-LFPR relationship. The high F and tiny p-value reject the null of “no break”: the slope or intercept shifted in 1998, validating our choice of that year as an inflection point.\n\n9.2.1 Key takeways\n\nStrength of relationship – Both Pearson r and the LM slope are large in magnitude and highly significant, underscoring that labour-market participation is the dominant quantitative correlate of fertility decline.\nAge-specific patterns matter – The Kruskal–Wallis result justifies separate age-band analysis; policy aimed at the 25-29 group (the steepest faller) will differ from measures for 35-39s.\nTiming of the break – The Chow test statistically anchors the narrative that 1998 (Asian Financial Crisis, policy shifts) altered family-formation dynamics, giving us a defensible breakpoint for before/after comparisons.\nPractical vs. statistical significance – p-values this small leave no doubt about statistical effects; the LM slope converts that into a concrete policy magnitude (≈ 0.035 drop in TFR for every 1 pp rise in LFPR).\n\nOverall, all four tests reinforce our groups storyline which is: rising female workforce participation, especially after the late-1990s shock, coincides with, and likely contributes to Singapore’s sustained fertility plunge, with pronounced differences by age cohort."
  },
  {
    "objectID": "index.html#comprehensive-plot",
    "href": "index.html#comprehensive-plot",
    "title": "Singapore’s Fertility Crisis: A Data-Driven Analysis of Socioeconomic Factors",
    "section": "7.1 Comprehensive Plot",
    "text": "7.1 Comprehensive Plot\nThe ‘Age-Band View’ allows for precise selection of marital status and labour status by age bands over the years. However, since the female populations is also split by age-band it is not meant to show aggregated totals of female population by marital status over the years. To view overall trends in female population of all ages, switch to the ‘Overall View’.\n\n\nShow Code\n# Load and clean data for Graph 1 (age_band != \"All\")\nfiltered_dataset_1 &lt;- final_dataset |&gt;\n  filter(age_band != \"All\") |&gt;\n  mutate(\n    marital_status  = tools::toTitleCase(trimws(as.character(marital_status))),\n    labour_status   = tools::toTitleCase(trimws(as.character(labour_status))),\n    age_band        = tools::toTitleCase(trimws(as.character(age_band))),\n    count           = as.numeric(as.character(count)),\n    fertility_rate  = as.numeric(as.character(fertility_rate)),\n    uom             = ifelse(age_band == \"All\", \"per female\", \"per thousand females\")\n  )\n\n# Calculate the aggregated total count for Graph 1\naggregated_data_1 &lt;- filtered_dataset_1 |&gt;\n  group_by(year, marital_status, labour_status) |&gt;\n  summarise(total_count = sum(count, na.rm = TRUE), .groups = \"drop\")\n\n# Merge the aggregated total count with the original data for Graph 1\nfiltered_dataset_1 &lt;- filtered_dataset_1 |&gt;\n  left_join(aggregated_data_1, by = c(\"year\", \"marital_status\", \"labour_status\"))\n\n# Load and clean data for Graph 2 (age_band == \"All\")\nfiltered_dataset_2 &lt;- final_dataset |&gt;\n  filter(age_band == \"All\") |&gt;\n  mutate(\n    marital_status  = tools::toTitleCase(trimws(as.character(marital_status))),\n    labour_status   = tools::toTitleCase(trimws(as.character(labour_status))),\n    age_band        = tools::toTitleCase(trimws(as.character(age_band))),\n    count           = as.numeric(as.character(count)),\n    fertility_rate  = as.numeric(as.character(fertility_rate)),\n    uom             = ifelse(age_band == \"All\", \"per female\", \"per thousand females\")\n  )\n\n# SharedData for interactivity - Graph 1\nshared_data_1 &lt;- SharedData$new(filtered_dataset_1, group = \"graph1_filter\")\n\n# SharedData for interactivity - Graph 2  \nshared_data_2 &lt;- SharedData$new(filtered_dataset_2, group = \"graph2_filter\")\n\n# SharedData for lines/points in Graph 2 (excluding missing years)\nshared_data_2_lines_points &lt;- SharedData$new(\n  filtered_dataset_2 |&gt; filter(!(year %in% c(1995, 2000, 2005))),\n  group = \"graph2_filter\"\n)\n\n# Filter controls for Graph 1\nfilter_marital_1 &lt;- filter_select(\"filter_marital_1\", \"Marital Status:\", shared_data_1, ~marital_status)\nfilter_labour_1  &lt;- filter_select(\"filter_labour_1\", \"Labour Status:\", shared_data_1, ~labour_status)\nfilter_ageband_1 &lt;- filter_select(\"filter_ageband_1\", \"Age Band:\", shared_data_1, ~age_band)\nfilter_year_1 &lt;- filter_slider(\"filter_year_1\", \"Select Year Range:\", shared_data_1, ~year, step = 1)\n\n# Filter controls for Graph 2\nfilter_marital_2 &lt;- filter_select(\"filter_marital_2\", \"Marital Status:\", shared_data_2, ~marital_status)\nfilter_labour_2  &lt;- filter_select(\"filter_labour_2\", \"Labour Status:\", shared_data_2, ~labour_status)\nfilter_year_2 &lt;- filter_slider(\"filter_year_2\", \"Select Year Range:\", shared_data_2, ~year, step = 1)\n\n# Custom Colors for Marital Status\nmarital_colors &lt;- c(\n  \"Single\" = \"#32CD32\",\n  \"Married\" = \"#1E90FF\",\n  \"Widowed_divorced\" = \"#FF4500\"\n)\n\n# Custom Colors for Age Bands (Graph 1)\nage_colors_1 &lt;- setNames(brewer.pal(length(unique(filtered_dataset_1$age_band)), \"Dark2\"),\n                         unique(filtered_dataset_1$age_band))\n\n# Custom Colors for Age Bands (Graph 2)\nage_colors_2 &lt;- setNames(brewer.pal(length(unique(filtered_dataset_2$age_band)), \"Dark2\"),\n                         unique(filtered_dataset_2$age_band))\n\n# Scaling factors\nscale_factor_1 &lt;- max(filtered_dataset_1$count, na.rm = TRUE) / max(filtered_dataset_1$fertility_rate, na.rm = TRUE)\nscale_factor_2 &lt;- max(filtered_dataset_2$count, na.rm = TRUE) / max(filtered_dataset_2$fertility_rate, na.rm = TRUE)\n\n# Generate HTML for custom legends\n# Legend for Graph 1\nage_bands_1 &lt;- na.omit(unique(filtered_dataset_1$age_band))\ncol1_bands_1 &lt;- head(age_bands_1, 4)\ncol2_bands_1 &lt;- tail(age_bands_1, length(age_bands_1) - 4)\n\ncol1_html_1 &lt;- paste0(\n  sapply(col1_bands_1, function(b) {\n    sprintf('&lt;div style=\"display: flex; align-items: center; gap: 5px; margin-bottom: 5px;\"&gt;\n               &lt;div style=\"width: 15px; height: 15px; background-color: %s; border-radius: 3px;\"&gt;&lt;/div&gt;\n               &lt;span&gt;%s&lt;/span&gt;\n             &lt;/div&gt;', age_colors_1[b], b)\n  }), \n  collapse = \"\"\n)\n\ncol2_html_1 &lt;- paste0(\n  sapply(col2_bands_1, function(b) {\n    sprintf('&lt;div style=\"display: flex; align-items: center; gap: 5px; margin-bottom: 5px;\"&gt;\n               &lt;div style=\"width: 15px; height: 15px; background-color: %s; border-radius: 3px;\"&gt;&lt;/div&gt;\n               &lt;span&gt;%s&lt;/span&gt;\n             &lt;/div&gt;', age_colors_1[b], b)\n  }), \n  collapse = \"\"\n)\n\ncombined_legend_1 &lt;- sprintf('\n&lt;div style=\"display: flex; width: 100%%; gap: 15px; margin-top: 20px; font-family: Arial, sans-serif;\"&gt;\n  &lt;div style=\"flex: 1; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Marital Status&lt;/div&gt;\n    &lt;div style=\"display: flex; flex-direction: column; gap: 6px;\"&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #32CD32; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Single&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #1E90FF; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Married&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #FF4500; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Widowed/Divorced&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  &lt;div style=\"flex: 2; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Age Band&lt;/div&gt;\n    &lt;div style=\"display: flex; gap: 15px;\"&gt;\n      &lt;div style=\"flex: 1;\"&gt;%s&lt;/div&gt;\n      &lt;div style=\"flex: 1;\"&gt;%s&lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n', col1_html_1, col2_html_1)\n\n# Legend for Graph 2 (simpler since only \"All\" age band)\ncombined_legend_2 &lt;- '\n&lt;div style=\"display: flex; width: 100%; gap: 15px; margin-top: 20px; font-family: Arial, sans-serif;\"&gt;\n  &lt;div style=\"flex: 1; background-color: #f8f9fa; padding: 5px; border-radius: 5px; font-size: 12px;\"&gt;\n    &lt;div style=\"text-align: center; font-weight: bold; margin-bottom: 8px;\"&gt;Marital Status&lt;/div&gt;\n    &lt;div style=\"display: flex; flex-direction: column; gap: 6px;\"&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #32CD32; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Single&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #1E90FF; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Married&lt;/span&gt;\n      &lt;/div&gt;\n      &lt;div style=\"display: flex; align-items: center; gap: 6px;\"&gt;\n        &lt;div style=\"width: 12px; height: 12px; background-color: #FF4500; border-radius: 3px;\"&gt;&lt;/div&gt;\n        &lt;span&gt;Widowed/Divorced&lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n'\n\n# Create Plot 1\np1 &lt;- ggplot() +\n  geom_col(\n    data = shared_data_1,\n    aes(\n      x = factor(year),\n      y = count,\n      fill = marital_status,\n      group = interaction(labour_status, marital_status),\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Marital Status: \", marital_status,\n        \"&lt;br&gt;Labour Status: \", labour_status,\n        \"&lt;br&gt;Age Band: \", age_band,\n        \"&lt;br&gt;Count: \", comma(count),\n        \"&lt;br&gt;Total: \", comma(total_count)\n      )\n    ),\n    position = position_dodge(width = 0.7),\n    width = 0.6,\n    colour = \"white\",\n    size = 0.2,\n    alpha = 0.6\n  ) +\n  geom_line(\n    data = shared_data_1,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor_1,\n      group = age_band,\n      colour = age_band\n    ),\n    size = 0.8,\n    alpha = 0.6\n  ) +\n  geom_point(\n    data = shared_data_1,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor_1,\n      group = age_band,\n      colour = age_band,\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Age Band: \", age_band,\n        \"&lt;br&gt;Fertility Rate: \", round(fertility_rate, 2),\n        \"&lt;br&gt;Unit: \", uom\n      )\n    ),\n    size = 0.5,\n    alpha = 0.6\n  ) +\n  scale_fill_manual(values = marital_colors) +\n  scale_colour_manual(values = age_colors_1) +\n  scale_y_continuous(\n    name = \"Female Population (thousands)\",\n    labels = comma\n  ) +\n  labs(\n    title = \"Fertility Rates vs Labour Participation (Age-Banded View)\",\n    subtitle = \"Bars: Segmented by Marital Status; Points: Fertility Rates by Age Band\",\n    x = \"Year\",\n    caption = \"Source: SingStat & data.gov.sg\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    legend.position = \"none\"\n  )\n\n# Create Plot 2\np2 &lt;- ggplot() +\n  geom_col(\n    data = shared_data_2,\n    aes(\n      x = factor(year),\n      y = count,\n      fill = marital_status,\n      group = interaction(labour_status, marital_status),\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Marital Status: \", marital_status,\n        \"&lt;br&gt;Labour Status: \", labour_status,\n        \"&lt;br&gt;Female Population: \", comma(count)\n      )\n    ),\n    position = position_dodge(width = 0.7),\n    width = 0.6,\n    colour = \"white\",\n    size = 0.2,\n    alpha = 0.6\n  ) +\n  geom_line(\n    data = shared_data_2_lines_points,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor_2,\n      group = age_band,\n      colour = age_band\n    ),\n    size = 0.8,\n    alpha = 0.6\n  ) +\n  geom_point(\n    data = shared_data_2_lines_points,\n    aes(\n      x = as.factor(year),\n      y = fertility_rate * scale_factor_2,\n      group = age_band,\n      colour = age_band,\n      text = paste0(\n        \"Year: \", year,\n        \"&lt;br&gt;Fertility Rate: \", round(fertility_rate, 2),\n        \"&lt;br&gt;Unit: \", uom\n      )\n    ),\n    size = 0.5,\n    alpha = 0.6\n  ) +\n  scale_fill_manual(values = marital_colors) +\n  scale_colour_manual(values = age_colors_2) +\n  scale_y_continuous(\n    name = \"Female Population (thousands)\",\n    labels = comma\n  ) +\n  labs(\n    title = \"Fertility Rates vs Labour Participation (Overall View)\",\n    subtitle = \"Bars: Segmented by Marital Status; Points: Overall Fertility Rates\",\n    x = \"Year\",\n    caption = \"Source: SingStat & data.gov.sg\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    legend.position = \"none\"\n  )\n\n# Convert to plotly\nplotly_output_1 &lt;- ggplotly(p1, tooltip = \"text\") |&gt; \n  layout(\n    annotations = list(\n      list(x = 5, y = 0, text = \"No Data\", showarrow = FALSE,\n           font = list(size = 12, color = \"black\", family = \"Arial\"),\n           textangle = 90, xanchor = \"center\", yanchor = \"bottom\"),\n      list(x = 10, y = 0, text = \"No Data\", showarrow = FALSE,\n           font = list(size = 12, color = \"black\", family = \"Arial\"),\n           textangle = 90, xanchor = \"center\", yanchor = \"bottom\"),\n      list(x = 15, y = 0, text = \"No Data\", showarrow = FALSE,\n           font = list(size = 12, color = \"black\", family = \"Arial\"),\n           textangle = 90, xanchor = \"center\", yanchor = \"bottom\")\n    )\n  )\n\nplotly_output_2 &lt;- ggplotly(p2, tooltip = \"text\") |&gt; \n  layout(\n    annotations = list(\n      list(x = 5, y = 0, text = \"No Data\", showarrow = FALSE,\n           font = list(size = 12, color = \"black\", family = \"Arial\"),\n           textangle = 90, xanchor = \"center\", yanchor = \"bottom\"),\n      list(x = 10, y = 0, text = \"No Data\", showarrow = FALSE,\n           font = list(size = 12, color = \"black\", family = \"Arial\"),\n           textangle = 90, xanchor = \"center\", yanchor = \"bottom\"),\n      list(x = 15, y = 0, text = \"No Data\", showarrow = FALSE,\n           font = list(size = 12, color = \"black\", family = \"Arial\"),\n           textangle = 90, xanchor = \"center\", yanchor = \"bottom\")\n    )\n  )\n\n# JavaScript for toggle functionality\ntoggle_js &lt;- HTML('\n&lt;script&gt;\nfunction toggleGraph() {\n  var graph1 = document.getElementById(\"graph1-container\");\n  var graph2 = document.getElementById(\"graph2-container\");\n  var filters1 = document.getElementById(\"filters1-container\");\n  var filters2 = document.getElementById(\"filters2-container\");\n  var legend1 = document.getElementById(\"legend1-container\");\n  var legend2 = document.getElementById(\"legend2-container\");\n  var button = document.getElementById(\"toggle-button\");\n  \n  if (graph1.style.display === \"none\") {\n    // Show Graph 1\n    graph1.style.display = \"block\";\n    graph2.style.display = \"none\";\n    filters1.style.display = \"block\";\n    filters2.style.display = \"none\";\n    legend1.style.display = \"block\";\n    legend2.style.display = \"none\";\n    button.innerHTML = \"Switch to Overall View\";\n  } else {\n    // Show Graph 2\n    graph1.style.display = \"none\";\n    graph2.style.display = \"block\";\n    filters1.style.display = \"none\";\n    filters2.style.display = \"block\";\n    legend1.style.display = \"none\";\n    legend2.style.display = \"block\";\n    button.innerHTML = \"Switch to Age-Banded View\";\n  }\n}\n&lt;/script&gt;\n')\n\n# Final UI Layout with Toggle\ntagList(\n  toggle_js,\n  div(\n    style = \"margin-bottom:20px;\",\n    h3(\"Interactive Fertility & Labour Plot\"),\n    p(\"Use filters to explore connections between female population, labour, marital status counts and fertility rates.\"),\n    div(\n      style = \"margin-top: 10px;\",\n      tags$button(\n        id = \"toggle-button\",\n        onclick = \"toggleGraph()\",\n        style = \"background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;\",\n        \"Switch to Overall View\"\n      )\n    )\n  ),\n  \n  # Filters for Graph 1\n  div(\n    id = \"filters1-container\",\n    style = \"display: block;\",\n    div(\n      style = \"display: flex; gap: 15px; margin-bottom: 20px;\",\n      filter_marital_1,\n      filter_labour_1,\n      filter_ageband_1\n    ),\n    div(\n      style = \"margin-bottom: 20px;\",\n      filter_year_1\n    )\n  ),\n  \n  # Filters for Graph 2  \n  div(\n    id = \"filters2-container\",\n    style = \"display: none;\",\n    div(\n      style = \"display: flex; gap: 15px; margin-bottom: 20px;\",\n      filter_marital_2,\n      filter_labour_2\n    ),\n    div(\n      style = \"margin-bottom: 20px;\",\n      filter_year_2\n    )\n  ),\n  \n  # Graph 1 Container\n  div(\n    id = \"graph1-container\",\n    style = \"display: block;\",\n    plotly_output_1\n  ),\n  \n  # Graph 2 Container\n  div(\n    id = \"graph2-container\", \n    style = \"display: none;\",\n    plotly_output_2\n  ),\n  \n  # Footnote Section\n  div(\n    style = \"margin-top: 20px; font-size: 12px; color: #555; text-align: center;\",\n    p(\"Population data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years.\"),\n    p(\"Source: data.gov.sg & SingStat\")\n  ),\n  \n  # Legend for Graph 1\n  div(\n    id = \"legend1-container\",\n    style = \"display: block;\",\n    HTML(combined_legend_1)\n  ),\n  \n  # Legend for Graph 2\n  div(\n    id = \"legend2-container\",\n    style = \"display: none;\",\n    HTML(combined_legend_2)\n  )\n)\n\n\n\n\n\n\nInteractive Fertility & Labour Plot\nUse filters to explore connections between female population, labour, marital status counts and fertility rates.\n\nSwitch to Overall View\n\n\n\n\n\nMarital Status:\n\n\n\n\n\n\nLabour Status:\n\n\n\n\n\n\nAge Band:\n\n\n\n\n\n\n\n\nSelect Year Range:\n\n\n\n\n\n\n\n\nMarital Status:\n\n\n\n\n\n\nLabour Status:\n\n\n\n\n\n\n\n\nSelect Year Range:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation data for 1995, 2000, and 2005 are not available as the Comprehensive Labour Force Survey was not conducted in these years.\nSource: data.gov.sg & SingStat\n\n\n\n  \n    Marital Status\n    \n      \n        \n        Single\n      \n      \n        \n        Married\n      \n      \n        \n        Widowed/Divorced\n      \n    \n  \n  \n    Age Band\n    \n      \n               \n               15-19\n             \n               \n               20-24\n             \n               \n               25-29\n             \n               \n               30-34\n             \n      \n               \n               35-39\n             \n               \n               40-44\n             \n               \n               45-49\n             \n    \n  \n\n\n\n\n  \n    Marital Status\n    \n      \n        \n        Single\n      \n      \n        \n        Married\n      \n      \n        \n        Widowed/Divorced\n      \n    \n  \n\n\n\n\nSummary of Improvements to Weaknesses\nFor ‘Age-Banded View’\n\nExtended Analysis: Compared to the 2019–2023 analysis of the original, our visualisation expands the scope to fertility rates from 1991 to 2022.\nSocio-Economic Factors: The original visualisation lacked explanatory power for Singapore’s fertility decline. This plot introduces dimensions like female population by age bands, allowing users to evaluate female labour status and marital status, revealing potential causal relationships between these factors and fertility rates.\nAge-Banded Fertility: Instead of a single total fertility rate, this allows the user to inspect age-banded fertility rates for age bands 15–49 in 5-year increments. This highlights how fertility behaviour shifts across cohorts, potentially unveiling the reasons behind Singapore’s declining fertility rate.\n\nFor ‘Overall View’\n\nSocio-Economic Factors: This provides an alternative overall perspective into how marital and labour status of females in Singapore is affecting total fertility rates. This plot is meant to reduce visual clutter by removing the dimension of age bands."
  }
]